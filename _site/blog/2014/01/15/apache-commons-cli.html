<!DOCTYPE html>
<html lang='zh-CN'>
<head>
    <title>Apache Commons 系列简介 之 CLI_博汇网_www.blogways.net</title>
    <meta name=keywords content="Apache Commons, cli">
    
    <meta name=description content="介绍Apache Commons 系列中的 CLI 库">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="http://cdn.bootcss.com/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="http://cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <script src='/js/jquery-2.1.1.js'></script>
    <link rel='stylesheet' type='text/css' href='/bootstrap/css/bootstrap.css'>
    <link rel='stylesheet' type='text/css' href='/bootstrap/css/bootstrap-theme.css'>
    <link rel='stylesheet' type='text/css' href='/css/app.css'>
    <script src='/bootstrap/js/bootstrap.js'></script>
    <script src='/js/app.js'></script>

</head>
<body style='background-color: #f5f5f5;'>
    <div class='totop'>
        <a id='to-top' href='javascript:void(0)'>
            <span id='to-top-title'>返回</br>顶部</span>
        </a>
    </div>
    <div class='headerbar'>
            <div class='navbar navbar-default navbar-fixed-top' role='navigation'>
        <div class='containr-fluid'>
            <div class='navbar-header'>
                <button type='button' class='navbar-toggle collapsed' data-toggle='collapse' data-target='#bw-navbar-collapse'>
                    <span class='sr-only'>下拉框</span>
                    <span class='icon-bar'></span>
                    <span class='icon-bar'></span>
                    <span class='icon-bar'></span>
                </button>
                <a class='navbar-brand' href='/'>Blog<span>ways</span></a>
            </div>
            <div class='navbar-collapse collapse' id='bw-navbar-collapse'>
                <ul class='nav navbar-nav'>
                    <li><a href='/'>主页</a></li>
                    <li class='divider visible-xs'></li>
                    <li class='active'><a href='javascript:void(0)'>博文</a></li>
                    <li class='dropdown'>
                        <a class="dropdown-toggle" data-toggle="dropdown" href="#">关于我们
                            <span class="caret"></span>
                        </a>
                        <ul class='dropdown-menu' role='menu'>
                            <li><a href='/about.html'>所有信息</a></li>
                            <li class='divider'></li>
                            <li><a href='/authors/jacky/'>Jacky</a></li>
                            <li><a href='/authors/tangshizhong/'>汤仕忠</a></li>
                            <li><a href='/authors/tangzhi/'>唐治</a></li>
                            <li><a href='/authors/wanzhou/'>万洲</a></li>
                        </ul>
                    </li>
                    <li class='disabled'><a href='javascript:void(0)'>联系我们</a></li>
                </ul>
                <!--<form class="navbar-form navbar-right hidden-sm hidden-xs" role="search">
                        <div class="form-group">
                            <input type="text" class="form-control" placeholder="Search">
                            <button type="submit" class="btn btn-default">Submit</button>
                    </div>
                </form>-->
                <p class="navbar-text navbar-right hidden-sm hidden-xs"><small>汇集优秀博文(关注:敏捷开发/WEB开发/移动终端开发/NOSQL/云计算...)尽在</small><a href="/" class="navbar-link">Blogways</a>!</p>
            </div>
        </div>    
    </div>

    </div>
        <script>
        $(document).ready(function(){
            (function(){
                $.getJSON("/authors.json",function(mJSON){
                    $.each( mJSON , function( i , item ){
                        var name = item.name.toLowerCase().replace(" ","") || "";
                        var page_name = "唐 治".toLowerCase().replace(" ","");
                        var num = item.articles.length || 0;
                        if(name == page_name){
                            $("#article_num").append( num + "篇博文" );
                        }
                    });
                });
            })();
        });
    </script>

    <div class='container'>
        <div class='row main-content'>
            <div class='col-md-9 col-sm-12 col-xs-12 mainbar'>
                <div class='article'>
                    <div class='panel panel-default article-extra'>
                        <div class='panel-body'>
                            <div class='article-pn'>
                                
                                <span class='pull-left'>上一篇:
                                    <a href='/blog/2014/01/15/apache-commons-beanutils.html' title='Apache Commons 系列简介 之 BeanUtils'>Apache Commons 系列简介 之 BeanUtils</a>
                                </span>
                                
                                
                                <span class='pull-right'>下一篇:
                                    <a href='/blog/2014/01/15/apache-commons-pool.html' title='Apache Commons 系列简介 之 Pool'>Apache Commons 系列简介 之 Pool</a>
                                </span>
                                
                            </div><!--end of article-pn-->                            
                            <hr class='hidden-sm hidden-xs'>
                            <div class='article-info'>
                                <div class='article-title'>
                                    <h2>Apache Commons 系列简介 之 CLI
                                        <small class='article-date'>
                                            <span class='glyphicon glyphicon-calendar'></span>&nbsp;
                                            <span class='sr-only'>发布于&nbsp;:&nbsp;</span>2014-01-15
                                        </small>
                                    </h2>
                                </div>
                                <div class='row article-tags'>
                                    <div class='col-xs-12 post-tags'>
                                        <span class='glyphicon glyphicon-tags'></span>&nbsp;
                                        
                                        <a class='label label-info' href='#'>Apache Commons</a>
                                        
                                        、
                                        
                                        <a class='label label-info' href='#'>cli</a>
                                        
                                        
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class='article-main'>
                        <div class='panel panel-default'>
                            <div class='panel-body'>
                                <div class='article-content'>
                                    <p><code>Apache Commons</code>的主要目的就是，创建和维护一个可重用的java组件库集合。这样Apache社区的开发者，就可以使用相同的基础组件库来开发不同的Apache项目了。</p>

<p>而<code>Apache Commons</code>的开发者们，将尽量减少这些组件对其他外部库的影响，来确保这些组件可以很容易地进行部署。另外，这些组件将尽可能地保证接口稳定，以便Apache用户（包括Apache项目）可以实现这些组件，而不必担心未来发生变化。</p>

<p>本文将介绍Commons系列中的CLI组件库。</p>

<h3>一、Commons CLI 概述</h3>

<p><code>Apache Commons CLI</code> 库提供API，可以帮助程序去解析传递给程序的命令行参数。他也可以打印帮助信息，来说明可以运用于命令行的有效参数。</p>

<p>CLI库支持不同格式的选项：</p>

<ol>
<li>POSIX格式的选项（比如：<code>tar -zxvf foo.tar.gz</code>）</li>
<li>GNU格式的长参数选项（比如：<code>du --human-readable --max-depth=1</code>）</li>
<li>Java格式的属性（比如：<code>java -Djava.awt.headless=true -Djava.net.useSystemProxies=true Foo</code>）</li>
<li>带值的单选项（比如：<code>gcc -O2 foo.c</code>）</li>
<li>单<code>-</code>号的长参数选项（比如：<code>ant -projecthelp</code>）</li>
</ol>


<p>CLI库可以提供的帮助信息，类似如下：</p>

<pre><code>usage: ls
 -A,--almost-all          do not list implied . and ..
 -a,--all                 do not hide entries starting with .
 -B,--ignore-backups      do not list implied entried ending with ~
 -b,--escape              print octal escapes for nongraphic characters
    --block-size &lt;SIZE&gt;   use SIZE-byte blocks
 -c                       with -lt: sort by, and show, ctime (time of last
                          modification of file status information) with
                          -l:show ctime and sort by name otherwise: sort
                          by ctime
 -C                       list entries by columns
</code></pre>

<h3>二、Commons CLI 下载</h3>

<p>截止本文撰写时，CLI的最新发布版本为<code>1.2</code>。</p>

<p>官方下载地址：</p>

<pre><code>http://commons.apache.org/proper/commons-cli/download_cli.cgi
</code></pre>

<p>源码：</p>

<pre><code>svn checkout http://svn.apache.org/repos/asf/commons/proper/cli/trunk/ commons-cli
</code></pre>

<p>在Maven工程中添加依赖：</p>

<pre><code>&lt;dependency&gt;
    &lt;groupId&gt;commons-cli&lt;/groupId&gt;
    &lt;artifactId&gt;commons-cli&lt;/artifactId&gt;
    &lt;version&gt;1.2&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>

<h3>三、使用场景</h3>

<h3>3.1 布尔选项</h3>

<p>布尔选项是命令行最常见的选项，作为开关使用，不带参数。如果命令行中存在该选项，那么选项值就为<code>true</code>，否则其值为<code>false</code>。</p>

<p>举例，如果程序需要布尔选项<code>-t</code>,代码如下：</p>

<pre><code>// create Options object
Options options = new Options();

// add t option
options.addOption("t", false, "display current time");
</code></pre>

<p>如上，必须创建<code>Options</code>选项，然后为其添加<code>Option</code>对象。</p>

<p>上例中，<code>addOption</code>方法有三个参数：第一个参数类型为<code>String</code>，给出参数的名字；第二个参数类型为<code>boolean</code>，用来标记该选项是否需要参数,在上面例子中，布尔选项不需要参数，所以设置为<code>false</code>；第三个参数是选项的描述信息，该描述信息在打印命令行帮助信息时，会显示出来。</p>

<p>另外，<code>addOption</code>还存在一个四个参数的调用方式：</p>

<pre><code>addOption(String opt, String longOpt, boolean hasArg, String description)
</code></pre>

<p>在这里，多了一个长选项参数，在后面的例子中，我们可以看到具体的使用。</p>

<h3>3.2 解析命令行参数</h3>

<p><code>CommandLineParser</code>提供的方法<code>parse</code>，就是用来解析命令行中的参数。接口<code>CommandLineParser</code>存在多种实现类，比如<code>BasicParser</code>、<code>PosixParser</code>和<code>GnuParser</code>，可以根据实际需求选择使用.</p>

<p>其中，<code>PosixParser</code>与<code>GnuParser</code>，顾名思义，其区别在于，前者把形如<code>-log</code>的选项作为三个选项(<code>l</code>、<code>o</code>和<code>g</code>)处理，而后者作为一个选项处理。</p>

<p>具体代码，参考如下：</p>

<pre><code>CommandLineParser parser = new GnuParser();
CommandLine cmd = parser.parse( options, args);
</code></pre>

<p>如果，我们要检查命令行中<code>t</code>选项是否被列出，可以使用<code>hasOption</code>方法。例如：</p>

<pre><code>if(cmd.hasOption("t")) {
    // 存在t选项的处理
}
else {
    // 不存在t选项的处理
}
</code></pre>

<h3>3.2 带参数选项</h3>

<p>除了布尔选项外，还有些选项是需要参数的。比如<code>c</code>选项需要参数，那么可以如下设置：</p>

<pre><code>// add c option
options.addOption("c", true, "country code");
</code></pre>

<p>并且，可以通过<code>getOptionValue</code>方法，获取命令行传入的参数：</p>

<pre><code>// get c option value
String countryCode = cmd.getOptionValue("c");

if(countryCode == null) {
    // print default date
}
else {
    // print date for country specified by countryCode
}
</code></pre>

<h3>3.3 Ant命令行实例</h3>

<p>在这里，我们使用一个被普遍使用的java应用程序Ant来解释如果使用CLI库的。</p>

<h4>3.3.1 先看看Ant的命令帮助</h4>

<pre><code>ant [options] [target [target2 [target3] ...]]
  Options: 
  -help                  print this message
  -projecthelp           print project help information
  -version               print the version information and exit
  -quiet                 be extra quiet
  -verbose               be extra verbose
  -debug                 print debugging information
  -emacs                 produce logging information without adornments
  -logfile &lt;file&gt;        use given file for log
  -logger &lt;classname&gt;    the class which is to perform logging
  -listener &lt;classname&gt;  add an instance of class as a project listener
  -buildfile &lt;file&gt;      use given buildfile
  -D&lt;property&gt;=&lt;value&gt;   use value for given property
  -find &lt;file&gt;           search for buildfile towards the root of the
                         filesystem and use it
</code></pre>

<h4>3.3.2 创建布尔选项</h4>

<p>为了代码清晰，在这里我们使用<code>Option</code>的构造方法来创建。</p>

<pre><code>Option help = new Option( "help", "print this message" );
Option projecthelp = new Option( "projecthelp", "print project help information" );
Option version = new Option( "version", "print the version information and exit" );
Option quiet = new Option( "quiet", "be extra quiet" );
Option verbose = new Option( "verbose", "be extra verbose" );
Option debug = new Option( "debug", "print debugging information" );
Option emacs = new Option( "emacs",
                           "produce logging information without adornments" );
</code></pre>

<h4>3.3.3 创建带参数的选项</h4>

<p>我们使用<code>OptionBuilder</code>来创建：</p>

<pre><code>Option logfile   = OptionBuilder.withArgName( "file" )
                                .hasArg()
                                .withDescription(  "use given file for log" )
                                .create( "logfile" );

Option logger    = OptionBuilder.withArgName( "classname" )
                                .hasArg()
                                .withDescription( "the class which it to perform "
                                                  + "logging" )
                                .create( "logger" );

Option listener  = OptionBuilder.withArgName( "classname" )
                                .hasArg()
                                .withDescription( "add an instance of class as "
                                                  + "a project listener" )
                                .create( "listener"); 

Option buildfile = OptionBuilder.withArgName( "file" )
                                .hasArg()
                                .withDescription(  "use given buildfile" )
                                .create( "buildfile");

Option find      = OptionBuilder.withArgName( "file" )
                                .hasArg()
                                .withDescription( "search for buildfile towards the "
                                                  + "root of the filesystem and use it" )
                                .create( "find" );
</code></pre>

<h4>3.3.4 创建java属性选项</h4>

<pre><code>Option property  = OptionBuilder.withArgName( "property=value" )
                                .hasArgs(2)
                                .withValueSeparator()
                                .withDescription( "use value for given property" )
                                .create( "D" );
</code></pre>

<h4>3.3.5 创建Options</h4>

<p>上面已经创建了每个选项，下面我们需要创建<code>Options</code>，然后继续使用<code>addOption</code>方法，向其中添加每个选项，代码如下：</p>

<pre><code>Options options = new Options();

options.addOption( help );
options.addOption( projecthelp );
options.addOption( version );
options.addOption( quiet );
options.addOption( verbose );
options.addOption( debug );
options.addOption( emacs );
options.addOption( logfile );
options.addOption( logger );
options.addOption( listener );
options.addOption( buildfile );
options.addOption( find );
options.addOption( property );
</code></pre>

<p><strong>说明：可以通过<code>Option</code>的<code>setRequired</code>方法来设置，选项是否为必输项，默认不是必输项。 </strong></p>

<h4>3.3.6 解析命令行参数</h4>

<p>我们需要创建一个<code>CommandLineParser</code>，并用它根据之前设置的<code>Options</code>来解析命令行参数，代码如下：</p>

<pre><code>public static void main( String[] args ) {
    // create the parser
    CommandLineParser parser = new GnuParser();
    try {
        // parse the command line arguments
        CommandLine line = parser.parse( options, args );
    }
    catch( ParseException exp ) {
        // oops, something went wrong
        System.err.println( "Parsing failed.  Reason: " + exp.getMessage() );
    }
}
</code></pre>

<h4>3.3.7 获取命令行参数</h4>

<p>使用<code>hasOption</code>方法来检查命令行是否传入选项，使用<code>getOptionValue</code>来获取传入的参数值。</p>

<p>代码如下：</p>

<pre><code>// has the buildfile argument been passed?
if( line.hasOption( "buildfile" ) ) {
    // initialise the member variable
    this.buildfile = line.getOptionValue( "buildfile" );
}
</code></pre>

<h4>3.3.8 设置程序用例/帮助信息</h4>

<p>CLI库还可以根据<code>Options</code>来自动显示程序的用例/帮助信息。代码如下：</p>

<pre><code>// automatically generate the help statement
HelpFormatter formatter = new HelpFormatter();
formatter.printHelp( "ant", options, true );
</code></pre>

<p>执行后生成下面信息：</p>

<pre><code>usage: ant
-D &lt;property=value&gt;     use value for given property
-buildfile &lt;file&gt;       use given buildfile
-debug                  print debugging information
-emacs                  produce logging information without adornments
-file &lt;file&gt;            search for buildfile towards the root of the
                        filesystem and use it
-help                   print this message
-listener &lt;classname&gt;   add an instance of class as a project listener
-logger &lt;classname&gt;     the class which it to perform logging
-projecthelp            print project help information
-quiet                  be extra quiet
-verbose                be extra verbose
-version                print the version information and exit
</code></pre>

<h3>3.4 再来一个<code>ls</code>实例</h3>

<p>下面是帮助信息：</p>

<pre><code>Usage: ls [OPTION]... [FILE]...
List information about the FILEs (the current directory by default).
Sort entries alphabetically if none of -cftuSUX nor --sort.

-a, --all                  do not hide entries starting with .
-A, --almost-all           do not list implied . and ..
-b, --escape               print octal escapes for nongraphic characters
    --block-size=SIZE      use SIZE-byte blocks
-B, --ignore-backups       do not list implied entries ending with ~
-c                         with -lt: sort by, and show, ctime (time of last
                           modification of file status information)
                           with -l: show ctime and sort by name
                           otherwise: sort by ctime
-C                         list entries by columns
</code></pre>

<p>下面是代码：</p>

<pre><code>// create the command line parser
CommandLineParser parser = new GnuParser();

// create the Options
Options options = new Options();
options.addOption( "a", "all", false, "do not hide entries starting with ." );
options.addOption( "A", "almost-all", false, "do not list implied . and .." );
options.addOption( "b", "escape", false, "print octal escapes for nongraphic "
                                         + "characters" );
options.addOption( OptionBuilder.withLongOpt( "block-size" )
                                .withDescription( "use SIZE-byte blocks" )
                                .hasArg()
                                .withArgName("SIZE")
                                .create() );
options.addOption( "B", "ignore-backups", false, "do not list implied entried "
                                                 + "ending with ~");
options.addOption( "c", false, "with -lt: sort by, and show, ctime (time of last " 
                               + "modification of file status information) with "
                               + "-l:show ctime and sort by name otherwise: sort "
                               + "by ctime" );
options.addOption( "C", false, "list entries by columns" );

String[] args = new String[]{ "--block-size=10" };

try {
    // parse the command line arguments
    CommandLine line = parser.parse( options, args );

    // validate that block-size has been set
    if( line.hasOption( "block-size" ) ) {
        // print the value of block-size
        System.out.println( line.getOptionValue( "block-size" ) );
    }
}
catch( ParseException exp ) {
    System.out.println( "Unexpected exception:" + exp.getMessage() );
}
</code></pre>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class='col-md-3 hidden-sm hidden-xs sidebar'>

                <div class='authorbar panel panel-default'>
                    <div class='panel-heading'>
                        <h4 class='panel-title'>作品信息</h4>
                    </div>
                    <div class='author-info row panel-body'>
                        <a class='col-lg-3 col-md-4'>
                            <img width='58' height='58' src='/images/pix3.jpg' alt='作者头像'>
                        </a>
                        <div class='col-md-6 media-body'>
                            
                            
                            
                            <h4 class='author-name media-heading'>
                                <a id='author_url' href='/authors/tangzhi/'>唐 治</a>
                            
                            </h4>
                            <span id='article_num'></span>
                        </div>
                    </div>
                </div><!--end of authorbar-->
                
                <div class='newbar panel panel-default'>
                    <div class='panel-heading'>
                        <h4 class='panel-title'>最新博文</h4>
                    </div>
                    <div class='list-group new-list'>
                        
                        <div class='list-group-item list-group-item-default'>
                            <h5 class='new-heading'>
                                <a href='/blog/2014/08/27/jQuery-source-analysis-ajax(2).html' title='jQuery源码解读[14] -- AJAX（2）'>jQuery源码解读[14] -- AJAX（2）</a>
                            </h5>
                            <span class='desc'>异步JavaScript和XML(Asynchronous JavaScr...</span>
                            <div class='new-post-info'>
                                <span class='new-date'>
                                    <span class='glyphicon glyphicon-calendar'></span>
                                    <span class='sr-only'>&nbsp;:&nbsp;</span>
                                    2014-08-27
                                </span>&nbsp;&nbsp;
                                <span class='new-author'>
                                    <span class='glyphicon glyphicon-user'></span>
                                    <span class='sr-only'>&nbsp;:&nbsp;</span>
                                    
                                    <a href='/authors/wanzhou/'>万洲</a>
                                </span>
                            </div>
                        </div>
                        <div class='list-group-item list-group-item-default'>
                            <h5 class='new-heading'>
                                <a href='/blog/2014/08/26/jQuery-source-analysis-ajax(1).html' title='jQuery源码解读[13] -- AJAX（1）'>jQuery源码解读[13] -- AJAX（1）</a>
                            </h5>
                            <span class='desc'>异步JavaScript和XML(Asynchronous JavaScr...</span>
                            <div class='new-post-info'>
                                <span class='new-date'>
                                    <span class='glyphicon glyphicon-calendar'></span>
                                    <span class='sr-only'>&nbsp;:&nbsp;</span>
                                    2014-08-26
                                </span>&nbsp;&nbsp;
                                <span class='new-author'>
                                    <span class='glyphicon glyphicon-user'></span>
                                    <span class='sr-only'>&nbsp;:&nbsp;</span>
                                    
                                    <a href='/authors/wanzhou/'>万洲</a>
                                </span>
                            </div>
                        </div>
                        <div class='list-group-item list-group-item-default'>
                            <h5 class='new-heading'>
                                <a href='/blog/2014/08/25/jQuery-source-analysis-attribute.html' title='jQuery源码解读[12] -- 特性属性操作'>jQuery源码解读[12] -- 特性属性操作</a>
                            </h5>
                            <span class='desc'>属性操作主要包括Attr特性和Prop属性两部分，attr特性就是存在于元...</span>
                            <div class='new-post-info'>
                                <span class='new-date'>
                                    <span class='glyphicon glyphicon-calendar'></span>
                                    <span class='sr-only'>&nbsp;:&nbsp;</span>
                                    2014-08-25
                                </span>&nbsp;&nbsp;
                                <span class='new-author'>
                                    <span class='glyphicon glyphicon-user'></span>
                                    <span class='sr-only'>&nbsp;:&nbsp;</span>
                                    
                                    <a href='/authors/wanzhou/'>万洲</a>
                                </span>
                            </div>
                        </div>
                        <div class='list-group-item list-group-item-default'>
                            <h5 class='new-heading'>
                                <a href='/blog/2014/08/22/jQuery-source-analysis-selector-expr.html' title='jQuery源码解读[11] -- 选择符表达式'>jQuery源码解读[11] -- 选择符表达式</a>
                            </h5>
                            <span class='desc'>jQuery的工厂函数$()用于在页面中查找要操作的元素，接收一个按照类似...</span>
                            <div class='new-post-info'>
                                <span class='new-date'>
                                    <span class='glyphicon glyphicon-calendar'></span>
                                    <span class='sr-only'>&nbsp;:&nbsp;</span>
                                    2014-08-22
                                </span>&nbsp;&nbsp;
                                <span class='new-author'>
                                    <span class='glyphicon glyphicon-user'></span>
                                    <span class='sr-only'>&nbsp;:&nbsp;</span>
                                    
                                    <a href='/authors/wanzhou/'>万洲</a>
                                </span>
                            </div>
                        </div>
                        <div class='list-group-item list-group-item-default'>
                            <h5 class='new-heading'>
                                <a href='/blog/2014/08/22/jQuery-source-analysis-css.html' title='jQuery源码解读[10] -- CSS样式应用'>jQuery源码解读[10] -- CSS样式应用</a>
                            </h5>
                            <span class='desc'>在JavaScript的世界里，效果会令操作体验及交互体验更胜一筹，通过j...</span>
                            <div class='new-post-info'>
                                <span class='new-date'>
                                    <span class='glyphicon glyphicon-calendar'></span>
                                    <span class='sr-only'>&nbsp;:&nbsp;</span>
                                    2014-08-22
                                </span>&nbsp;&nbsp;
                                <span class='new-author'>
                                    <span class='glyphicon glyphicon-user'></span>
                                    <span class='sr-only'>&nbsp;:&nbsp;</span>
                                    
                                    <a href='/authors/wanzhou/'>万洲</a>
                                </span>
                            </div>
                        </div>
                    </div>
                </div><!--end of newestbar-->
            </div>
        </div>
    </div>

</body>
</html>	
