<!DOCTYPE html>
<html lang='zh-CN'>
<head>
    <title>jQuery源码解读[2] -- 基础工具函数_博汇网_www.blogways.net</title>
    <meta name=keywords content="$, jQuery, 源码, prototype, extend, 工具函数">
    
    <meta name=description content="jQuery通过.extend和.fn.extend像jQuery的全局对象和实例对象中添工具函数，全局对象函数就像C/C++、JAVA中的静态函数，可以通过$.fnName()或者jQuery.fnName()来调用，而实例对象函数则似类中的方法，可为类的实例化对象调用，如：$(selector).fnName()或者jQuery(selector).fnName()等,本文主要叙述jQuery中扩展的工具类函数的函数原型及一些例子">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="http://cdn.bootcss.com/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="http://cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <script src='/js/jquery-2.1.1.js'></script>
    <link rel='stylesheet' type='text/css' href='/bootstrap/css/bootstrap.css'>
    <link rel='stylesheet' type='text/css' href='/bootstrap/css/bootstrap-theme.css'>
    <link rel='stylesheet' type='text/css' href='/css/app.css'>
    <script src='/bootstrap/js/bootstrap.js'></script>
    <script src='/js/app.js'></script>

</head>
<body style='background-color: #f5f5f5;'>
    <div class='totop'>
        <a id='to-top' href='javascript:void(0)'>
            <span id='to-top-title'>返回</br>顶部</span>
        </a>
    </div>
    <div class='headerbar'>
            <div class='navbar navbar-default navbar-fixed-top' role='navigation'>
        <div class='containr-fluid'>
            <div class='navbar-header'>
                <button type='button' class='navbar-toggle collapsed' data-toggle='collapse' data-target='#bw-navbar-collapse'>
                    <span class='sr-only'>下拉框</span>
                    <span class='icon-bar'></span>
                    <span class='icon-bar'></span>
                    <span class='icon-bar'></span>
                </button>
                <a class='navbar-brand' href='/'>Blog<span>ways</span></a>
            </div>
            <div class='navbar-collapse collapse' id='bw-navbar-collapse'>
                <ul class='nav navbar-nav'>
                    <li><a href='/'>主页</a></li>
                    <li class='divider visible-xs'></li>
                    <li class='active'><a href='javascript:void(0)'>博文</a></li>
                    <li class='dropdown'>
                        <a class="dropdown-toggle" data-toggle="dropdown" href="#">关于我们
                            <span class="caret"></span>
                        </a>
                        <ul class='dropdown-menu' role='menu'>
                            <li><a href='/about.html'>所有信息</a></li>
                            <li class='divider'></li>
                            <li><a href='/authors/jacky/'>Jacky</a></li>
                            <li><a href='/authors/tangshizhong/'>汤仕忠</a></li>
                            <li><a href='/authors/tangzhi/'>唐治</a></li>
                            <li><a href='/authors/wanzhou/'>万洲</a></li>
                        </ul>
                    </li>
                    <li class='disabled'><a href='javascript:void(0)'>联系我们</a></li>
                </ul>
                <!--<form class="navbar-form navbar-right hidden-sm hidden-xs" role="search">
                        <div class="form-group">
                            <input type="text" class="form-control" placeholder="Search">
                            <button type="submit" class="btn btn-default">Submit</button>
                    </div>
                </form>-->
                <p class="navbar-text navbar-right hidden-sm hidden-xs"><small>汇集优秀博文(关注:敏捷开发/WEB开发/移动终端开发/NOSQL/云计算...)尽在</small><a href="/" class="navbar-link">Blogways</a>!</p>
            </div>
        </div>    
    </div>

    </div>
        <script>
        $(document).ready(function(){
            (function(){
                $.getJSON("/authors.json",function(mJSON){
                    $.each( mJSON , function( i , item ){
                        var name = item.name.toLowerCase().replace(" ","") || "";
                        var page_name = "万洲".toLowerCase().replace(" ","");
                        var num = item.articles.length || 0;
                        if(name == page_name){
                            $("#article_num").append( num + "篇博文" );
                        }
                    });
                });
            })();
        });
    </script>

    <div class='container'>
        <div class='row main-content'>
            <div class='col-md-9 col-sm-12 col-xs-12 mainbar'>
                <div class='article'>
                    <div class='panel panel-default article-extra'>
                        <div class='panel-body'>
                            <div class='article-pn'>
                                
                                <span class='pull-left'>上一篇:
                                    <a href='/blog/2014/08/10/jQuery-source-analysis-one.html' title='jQuery源码解读[1] -- 总体结构及构造函数'>jQuery源码解读[1] -- 总体结构及构造函数</a>
                                </span>
                                
                                
                                <span class='pull-right'>下一篇:
                                    <a href='/blog/2014/08/12/jQuery-source-analysis-dom-traversal.html' title='jQuery源码解读[3] -- 简单DOM遍历方法'>jQuery源码解读[3] -- 简单DOM遍历方法</a>
                                </span>
                                
                            </div><!--end of article-pn-->                            
                            <hr class='hidden-sm hidden-xs'>
                            <div class='article-info'>
                                <div class='article-title'>
                                    <h2>jQuery源码解读[2] -- 基础工具函数
                                        <small class='article-date'>
                                            <span class='glyphicon glyphicon-calendar'></span>&nbsp;
                                            <span class='sr-only'>发布于&nbsp;:&nbsp;</span>2014-08-10
                                        </small>
                                    </h2>
                                </div>
                                <div class='row article-tags'>
                                    <div class='col-xs-12 post-tags'>
                                        <span class='glyphicon glyphicon-tags'></span>&nbsp;
                                        
                                        <a class='label label-info' href='#'>$</a>
                                        
                                        、
                                        
                                        <a class='label label-info' href='#'>jQuery</a>
                                        
                                        、
                                        
                                        <a class='label label-info' href='#'>源码</a>
                                        
                                        、
                                        
                                        <a class='label label-info' href='#'>prototype</a>
                                        
                                        、
                                        
                                        <a class='label label-info' href='#'>extend</a>
                                        
                                        、
                                        
                                        <a class='label label-info' href='#'>工具函数</a>
                                        
                                        
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class='article-main'>
                        <div class='panel panel-default'>
                            <div class='panel-body'>
                                <div class='article-content'>
                                    <h2>一、前言</h2>

<p>前面一次讲了在<code>jQuery</code>源码中，是通过<code>jQuery.extend</code>和<code>jQuery.fn.extend</code>将后续的大部分功能进行扩展的。<code>jQuery.extend</code>扩展<code>jQuery</code>的<strong>全局对象</strong>，<code>jQuery.fn.extend</code>扩展<code>jQuery</code>的<strong>实例对象</strong>。</p>

<p>要了解<code>jQuery</code>工具函数的扩展，首先要了解<code>jQuery.extend</code>和<code>jQuery.fn.extend</code>的实现，便于了解其工作原理，这样在后面的学习中才不会有疑惑的地方。</p>

<h3>1、jQuery.extend和jQuery.fn.extend的实现</h3>

<p>在<code>jquery-1.11.1.js</code>中，其源码如下所示：</p>

<pre><code>// .extend( [ boolean, ] target, src1, src2, ... )
// .fn.extend( target)
// 上面为两个函数的原型，其中extend包含一个可选的boolean型参数，其含义为是否进行深度扩展
// 此处的target为 接受扩展 的对象
jQuery.extend = jQuery.fn.extend = function() {
    var src, copyIsArray, copy, name, options, clone,

    // 若无特殊情况，参数中的第一个为target，若没有传递参数，默认为{}
    target = arguments[0] || {},            i = 1,
    length = arguments.length,

    // 是否进行深度复制的flag，即为参数中[ boolean ]所传递过来的值，默认为false
    deep = false;   

    // 处理深度复制的情况，若设置了[ boolean ]，则其位置必为arguments中第一个(arguments[0])
    if ( typeof target === "boolean" ) {
        deep = target;

        // 跳过 [ boolean ] 参数，取得target扩展对象
        target = arguments[ i ] || {};
        i++;
    }

    // 处理target是一个string或其他什么（可能发生在深度复制中）
    if ( typeof target !== "object" &amp;&amp; !jQuery.isFunction(target) ) {
        target = {};
    }

    // 如果只有一个参数被传递过来，则扩展jQuery自己，即将target值设为this
    if ( i === length ) {
        target = this;
        i--;
    }

    for ( ; i &lt; length; i++ ) {
        // 只处理不为空或undefined值
        if ( (options = arguments[ i ]) != null ) {
            // 扩展基础对象
            for ( name in options ) {
                src = target[ name ];
                copy = options[ name ];

                // 防止死循环
                if ( target === copy ) {
                    continue;   // 当传递过来的参数中的所有属性及方法，
                }

                // 如果进行深度扩展，且我们正在合并的是一个纯对象或者数组，就递归调用
                if ( deep &amp;&amp; copy &amp;&amp; ( jQuery.isPlainObject(copy) 
                        || (copyIsArray = jQuery.isArray(copy)) ) ) {
                    if ( copyIsArray ) {
                        copyIsArray = false;
                        clone = src &amp;&amp; jQuery.isArray(src) ? src : [];
                    } else {
                        clone = src &amp;&amp; jQuery.isPlainObject(src) ? src : {};
                    }
                    // 别直接修改原始对象，而是使用他们的一个副本
                    target[ name ] = jQuery.extend( deep, clone, copy );
                // 排除参数中的undefined值
                } else if ( copy !== undefined ) {
                    target[ name ] = copy;
                }
            }
        }
    }
    // 返回修改过后的对象
    return target;
};
</code></pre>

<p>源码中通过<code>target[ name ] = jQuery.extend( deep, clone, copy );</code>和<code>target[ name ] = copy;</code>来具体实现目标对象的扩展，前者在选择了深度扩展且扩展对象为数组或纯对象时，通过递归调用<code>jQuery.extend</code>实现，后者是直接赋值。</p>

<p>两者相同一点就是同名属性或方法的直接赋值，这就使得后面的属性或方法会<strong>覆盖</strong>前面或者<code>target</code>中的同名属性或方法。而当<code>jQuery.extend</code>只有一个参数的时候，会将其扩展到<code>jQuery</code>的<strong>全局对象</strong>或<strong>实例对象</strong>当中去，我们可以利用这一特性，扩展<code>jQuery</code>的功能，而实际上我们也是这么做的，这个会在后面谈到，此处不再详细说明。</p>

<h2>二、工具函数</h2>

<h3>1、工具函数的函数原型</h3>

<p><code>jQuery.extend</code>中扩展的<strong>全局对象</strong>工具函数，其函数原型如下所示：</p>

<pre><code>jQuery.extend({
    // 在页面中生成一个唯一标识每一个副本jQuery
    expando: "jQuery" + ( version + Math.random() ).replace( /\D/g, "" ),

    // 在没有ready模块时，假定jQuery准备完成
    isReady: true,
    // 抛出指定的错误信息
    error: function( msg ) {    throw new Error( msg );    },
    // 空操作
    noop: function() {},
    isFunction: function( obj ) {},     // 判断参数是否为一个函数

    // 当Array存在判断函数时，只做一个简单的赋值引用，若无则手动创建一个
    isArray: Array.isArray || function( obj ) {},   

    isWindow: function( obj ) {},   // 判断参数是否为浏览器窗口对象window

    isNumeric: function( obj ) {},  // 判断参数是不是数值

    isEmptyObject: function( obj ) {},  // 判断参数是否是一个空对象

    // 判断参数obj是不是通过对象字面量或new Object创建的
    isPlainObject: function( obj ) {},  

    type: function( obj ) {},  // 返回obj类型

    globalEval: function( data ) {},   // 在全局上下文中，求给定的JavaScript字符串数据的值

    // 将参数字符串转换为骆驼表示法，如camelCase,nodeName等，
    // 基本上jQuery中所有的方法都是用的骆驼表示法
    camelCase: function( string ) {},   

    nodeName: function( elem, name ) {},    // 返回指定元素的节点名称与给定的名字是否一样

    // args 仅在each内部使用，对obj执行规定运行的函数callback
    each: function( obj, callback, args ) {},

    trim: function( text ) {},  // 去除参数text末尾中的空白符，包括回车、空格、制表符、换行符

    // results 仅在内部使用，转换一个类似数组的对象成为真正的JavaScript数组
    makeArray: function( arr, results ) {   }, 

    // 确定第一个参数在数组中的位置(如果没有找到则返回 -1 )
    inArray: function( elem, arr, i ) {},  

    merge: function( first, second ) {},  // 将两个参数合并，并返回合并后的值

    grep: function( elems, callback, invert ) {},  // 数组元素过滤筛选

    // arg 仅在内部使用，对当前集合elems中的每个元素调用callback，
    // 将返回结果作为一个新的jQuery对象
    map: function( elems, callback, arg ) {},

    // 一个对象的全局的GUID计数器
    guid: 1,

    // optionally partially applying any arguments
    // 创建一个新的，在指定上下文中执行的函数
    proxy: function( fn, context ) {},

    now: function() { return +( new Date() ); },  // 返回当前时间

    // jQuery.support is not used in Core but other projects attach their
    // properties to it so it needs to exist.
    support: support
});
</code></pre>

<p><code>jQuery.fn.extend</code>中扩展的<strong>实例对象</strong>工具函数，其函数原型如下代码所示：</p>

<pre><code>jQuery.fn.extend({
    // 返回与给定selector选择符匹配的后代元素
    find: function( selector ) {},
    // 与给定的选择符selector匹配的选中元素
    filter: function( selector ) {},

    not: function( selector ) {},   // 选中给定元素集中与给定选择符不匹配的元素

    // 根据选择符来检测匹配元素集合，如果这些元素中至少有一个元素匹配给定的参数，则返回 true
    is: function( selector ) {}     
});
</code></pre>

<h2>三、源码分析</h2>

<h3>1、each（ obj, callback ）遍历</h3>

<p><code>jQuery</code>中，<code>each</code>的源码中关键代码如下所示：</p>

<pre><code>var value,
    i = 0,
    length = obj.length,
    isArray = isArraylike( obj );

    if ( isArray ) {
        for ( ; i &lt; length; i++ ) {
            value = callback.call( obj[ i ], i, obj[ i ] );
            if ( value === false ) {
                break;
            }
        }
    } else {
        for ( i in obj ) {
            value = callback.call( obj[ i ], i, obj[ i ] );

            if ( value === false ) {
                break;
            }
        }
    }
return obj;
</code></pre>

<p>首先通过<strong>数组</strong>和<strong>对象</strong>两种方式来遍历参数<code>obj</code>，对<code>obj</code>中的每个元素调用<code>callback.call</code>将每个元素绑定到回调函数上执行，并返回执行结果。</p>

<p>当回调函数返回<code>false</code>，则停止循环。在其源码中还涉及到<code>callback.apply</code>的方式来调用回调函数，其作用于<code>call</code>一样，都是将函数绑定到另外一个对象上去运行。关于<code>call</code>与<code>apply</code>的详细说明，可以跳转到<a href="http://www.blogways.net/blog/2014/07/22/somethings-of-array-and-function.html" title="JavaScript中，Array和Function的那些事儿">JavaScript中，Array和Function的那些事儿</a>查看详细信息！</p>

<h3>示例：</h3>

<p>测试代码如下所示：</p>

<pre><code>&lt;html&gt;
    &lt;head&gt;
        &lt;script type="text/javascript" src="/jquery/jquery.js"&gt;&lt;/script&gt;
        &lt;script type="text/javascript"&gt;
            $(document).ready(function(){
                $("button").click(function(){
                    $("li").each(function(){
                        alert($(this).text())
                    });
                });
            });
    &lt;/script&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;button&gt;输出每个列表项的值&lt;/button&gt;
        &lt;ul&gt;
            &lt;li&gt;Coffee&lt;/li&gt;
            &lt;li&gt;Milk&lt;/li&gt;
            &lt;li&gt;Soda&lt;/li&gt;
        &lt;/ul&gt;
    &lt;/body&gt;
&lt;/html&gt;
</code></pre>

<p>运行上面代码，会依次弹出三个警示框，分别显示<code>&lt;li&gt;&lt;/li&gt;</code>中的值。你可以到<a href="http://www.w3school.com.cn/tiy/t.asp?f=jquery_traversing_each">$.each()遍历</a>运行测试样例！</p>

<p>其中<code>function(){}</code>就是<code>each( obj, callback )</code>中的回调函数<code>callback</code>，此处只是显示列表项的值，不需要指定特定的<code>index</code>和<code>element</code>，在某些情况下需要用之来辨别当前所遍历的元素，如：</p>

<pre><code>var info = [ 
        { "name":"aaa", "age":22, "hobby":["a","b","c"] },
        { "name":"bbb", "age":23, "hobby":["a","b","d"] },
        { "name":"ccc", "age":22, "hobby":["a","c","d"] } 
    ];
$.each( info, function( index, item ){
    var name = item.name,
        age = item.age,
        hobby = item.hobby;
    alert("My name is " + name + ",I am " + age + 
                    " years old,my hobbies are " + hobby);
});
</code></pre>

<p>上面的代码会逐条输出<code>info</code>中的信息，你可以将上面代码复制到<a href="http://jsfiddle.net">JSFiddle</a>运行测试！</p>

<p>其中<code>index</code>为当前元素在<code>info</code>中的索引，<code>item</code>是对当前遍历元素的引用，因此在函数体内使用<code>item.name/age/hobby</code>即可得到当前遍历元素的值，然后通过<code>alert()</code>显示到界面。</p>

<hr />

<p><strong>未完待续。。。</strong></p>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class='col-md-3 hidden-sm hidden-xs sidebar'>

                <div class='authorbar panel panel-default'>
                    <div class='panel-heading'>
                        <h4 class='panel-title'>作品信息</h4>
                    </div>
                    <div class='author-info row panel-body'>
                        <a class='col-lg-3 col-md-4'>
                            <img width='58' height='58' src='/images/pix3.jpg' alt='作者头像'>
                        </a>
                        <div class='col-md-6 media-body'>
                            
                            
                            
                            
                            <h4 class='author-name media-heading'>
                                <a id='author_url' href='/authors/wanzhou/'>万洲</a>
                            </h4>
                            <span id='article_num'></span>
                        </div>
                    </div>
                </div><!--end of authorbar-->
                
                <div class='newbar panel panel-default'>
                    <div class='panel-heading'>
                        <h4 class='panel-title'>最新博文</h4>
                    </div>
                    <div class='list-group new-list'>
                        
                        <div class='list-group-item list-group-item-default'>
                            <h5 class='new-heading'>
                                <a href='/blog/2014/08/27/jQuery-source-analysis-ajax(2).html' title='jQuery源码解读[14] -- AJAX（2）'>jQuery源码解读[14] -- AJAX（2）</a>
                            </h5>
                            <span class='desc'>异步JavaScript和XML(Asynchronous JavaScr...</span>
                            <div class='new-post-info'>
                                <span class='new-date'>
                                    <span class='glyphicon glyphicon-calendar'></span>
                                    <span class='sr-only'>&nbsp;:&nbsp;</span>
                                    2014-08-27
                                </span>&nbsp;&nbsp;
                                <span class='new-author'>
                                    <span class='glyphicon glyphicon-user'></span>
                                    <span class='sr-only'>&nbsp;:&nbsp;</span>
                                    
                                    <a href='/authors/wanzhou/'>万洲</a>
                                </span>
                            </div>
                        </div>
                        <div class='list-group-item list-group-item-default'>
                            <h5 class='new-heading'>
                                <a href='/blog/2014/08/26/jQuery-source-analysis-ajax(1).html' title='jQuery源码解读[13] -- AJAX（1）'>jQuery源码解读[13] -- AJAX（1）</a>
                            </h5>
                            <span class='desc'>异步JavaScript和XML(Asynchronous JavaScr...</span>
                            <div class='new-post-info'>
                                <span class='new-date'>
                                    <span class='glyphicon glyphicon-calendar'></span>
                                    <span class='sr-only'>&nbsp;:&nbsp;</span>
                                    2014-08-26
                                </span>&nbsp;&nbsp;
                                <span class='new-author'>
                                    <span class='glyphicon glyphicon-user'></span>
                                    <span class='sr-only'>&nbsp;:&nbsp;</span>
                                    
                                    <a href='/authors/wanzhou/'>万洲</a>
                                </span>
                            </div>
                        </div>
                        <div class='list-group-item list-group-item-default'>
                            <h5 class='new-heading'>
                                <a href='/blog/2014/08/25/jQuery-source-analysis-attribute.html' title='jQuery源码解读[12] -- 特性属性操作'>jQuery源码解读[12] -- 特性属性操作</a>
                            </h5>
                            <span class='desc'>属性操作主要包括Attr特性和Prop属性两部分，attr特性就是存在于元...</span>
                            <div class='new-post-info'>
                                <span class='new-date'>
                                    <span class='glyphicon glyphicon-calendar'></span>
                                    <span class='sr-only'>&nbsp;:&nbsp;</span>
                                    2014-08-25
                                </span>&nbsp;&nbsp;
                                <span class='new-author'>
                                    <span class='glyphicon glyphicon-user'></span>
                                    <span class='sr-only'>&nbsp;:&nbsp;</span>
                                    
                                    <a href='/authors/wanzhou/'>万洲</a>
                                </span>
                            </div>
                        </div>
                        <div class='list-group-item list-group-item-default'>
                            <h5 class='new-heading'>
                                <a href='/blog/2014/08/22/jQuery-source-analysis-selector-expr.html' title='jQuery源码解读[11] -- 选择符表达式'>jQuery源码解读[11] -- 选择符表达式</a>
                            </h5>
                            <span class='desc'>jQuery的工厂函数$()用于在页面中查找要操作的元素，接收一个按照类似...</span>
                            <div class='new-post-info'>
                                <span class='new-date'>
                                    <span class='glyphicon glyphicon-calendar'></span>
                                    <span class='sr-only'>&nbsp;:&nbsp;</span>
                                    2014-08-22
                                </span>&nbsp;&nbsp;
                                <span class='new-author'>
                                    <span class='glyphicon glyphicon-user'></span>
                                    <span class='sr-only'>&nbsp;:&nbsp;</span>
                                    
                                    <a href='/authors/wanzhou/'>万洲</a>
                                </span>
                            </div>
                        </div>
                        <div class='list-group-item list-group-item-default'>
                            <h5 class='new-heading'>
                                <a href='/blog/2014/08/22/jQuery-source-analysis-css.html' title='jQuery源码解读[10] -- CSS样式应用'>jQuery源码解读[10] -- CSS样式应用</a>
                            </h5>
                            <span class='desc'>在JavaScript的世界里，效果会令操作体验及交互体验更胜一筹，通过j...</span>
                            <div class='new-post-info'>
                                <span class='new-date'>
                                    <span class='glyphicon glyphicon-calendar'></span>
                                    <span class='sr-only'>&nbsp;:&nbsp;</span>
                                    2014-08-22
                                </span>&nbsp;&nbsp;
                                <span class='new-author'>
                                    <span class='glyphicon glyphicon-user'></span>
                                    <span class='sr-only'>&nbsp;:&nbsp;</span>
                                    
                                    <a href='/authors/wanzhou/'>万洲</a>
                                </span>
                            </div>
                        </div>
                    </div>
                </div><!--end of newestbar-->
            </div>
        </div>
    </div>

</body>
</html>	
