<!DOCTYPE html>
<html lang='zh-CN'>
<head>
    <title>Express4.x API 翻译[4] -- Router_博汇网_www.blogways.net</title>
    <meta name=keywords content="Node, Express, API">
    
    <meta name=description content="总算翻译完了，英文太差，很多借助于工具翻译的，如果有跟原文大相径庭的地方欢迎吐槽。">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="http://cdn.bootcss.com/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="http://cdn.bootcss.com/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
    <script src='/js/jquery-2.1.1.js'></script>
    <link rel='stylesheet' type='text/css' href='/bootstrap/css/bootstrap.css'>
    <link rel='stylesheet' type='text/css' href='/bootstrap/css/bootstrap-theme.css'>
    <link rel='stylesheet' type='text/css' href='/css/app.css'>
    <script src='/bootstrap/js/bootstrap.js'></script>
    <script src='/js/app.js'></script>

</head>
<body style='background-color: #f5f5f5;'>
    <div class='totop'>
        <a id='to-top' href='javascript:void(0)'>
            <span id='to-top-title'>返回</br>顶部</span>
        </a>
    </div>
    <div class='headerbar'>
            <div class='navbar navbar-default navbar-fixed-top' role='navigation'>
        <div class='containr-fluid'>
            <div class='navbar-header'>
                <button type='button' class='navbar-toggle collapsed' data-toggle='collapse' data-target='#bw-navbar-collapse'>
                    <span class='sr-only'>下拉框</span>
                    <span class='icon-bar'></span>
                    <span class='icon-bar'></span>
                    <span class='icon-bar'></span>
                </button>
                <a class='navbar-brand' href='/'>Blog<span>ways</span></a>
            </div>
            <div class='navbar-collapse collapse' id='bw-navbar-collapse'>
                <ul class='nav navbar-nav'>
                    <li><a href='/'>主页</a></li>
                    <li class='divider visible-xs'></li>
                    <li class='active'><a href='javascript:void(0)'>博文</a></li>
                    <li class='dropdown'>
                        <a class="dropdown-toggle" data-toggle="dropdown" href="#">关于我们
                            <span class="caret"></span>
                        </a>
                        <ul class='dropdown-menu' role='menu'>
                            <li><a href='/about.html'>所有信息</a></li>
                            <li class='divider'></li>
                            <li><a href='/authors/jacky/'>Jacky</a></li>
                            <li><a href='/authors/tangshizhong/'>汤仕忠</a></li>
                            <li><a href='/authors/tangzhi/'>唐治</a></li>
                            <li><a href='/authors/wanzhou/'>万洲</a></li>
                        </ul>
                    </li>
                    <li class='disabled'><a href='javascript:void(0)'>联系我们</a></li>
                </ul>
                <!--<form class="navbar-form navbar-right hidden-sm hidden-xs" role="search">
                        <div class="form-group">
                            <input type="text" class="form-control" placeholder="Search">
                            <button type="submit" class="btn btn-default">Submit</button>
                    </div>
                </form>-->
                <p class="navbar-text navbar-right hidden-sm hidden-xs"><small>汇集优秀博文(关注:敏捷开发/WEB开发/移动终端开发/NOSQL/云计算...)尽在</small><a href="/" class="navbar-link">Blogways</a>!</p>
            </div>
        </div>    
    </div>

    </div>
        <script>
        $(document).ready(function(){
            (function(){
                $.getJSON("/authors.json",function(mJSON){
                    $.each( mJSON , function( i , item ){
                        var name = item.name.toLowerCase().replace(" ","") || "";
                        var page_name = "Jacky".toLowerCase().replace(" ","");
                        var num = item.articles.length || 0;
                        if(name == page_name){
                            $("#article_num").append( num + "篇博文" );
                        }
                    });
                });
            })();
        });
    </script>

    <div class='container'>
        <div class='row main-content'>
            <div class='col-md-9 col-sm-12 col-xs-12 mainbar'>
                <div class='article'>
                    <div class='panel panel-default article-extra'>
                        <div class='panel-body'>
                            <div class='article-pn'>
                                
                                <span class='pull-left'>上一篇:
                                    <a href='/blog/2014/06/13/node-express4.x-api-3.html' title='Express4.x API 翻译[3] -- Response'>Express4.x API 翻译[3] -- Response</a>
                                </span>
                                
                                
                                <span class='pull-right'>下一篇:
                                    <a href='/blog/2014/07/22/somethings-of-array-and-function.html' title='JavaScript中，Array和Function的那些事儿'>JavaScript中，Array和Function的那些事儿</a>
                                </span>
                                
                            </div><!--end of article-pn-->                            
                            <hr class='hidden-sm hidden-xs'>
                            <div class='article-info'>
                                <div class='article-title'>
                                    <h2>Express4.x API 翻译[4] -- Router
                                        <small class='article-date'>
                                            <span class='glyphicon glyphicon-calendar'></span>&nbsp;
                                            <span class='sr-only'>发布于&nbsp;:&nbsp;</span>2014-06-16
                                        </small>
                                    </h2>
                                </div>
                                <div class='row article-tags'>
                                    <div class='col-xs-12 post-tags'>
                                        <span class='glyphicon glyphicon-tags'></span>&nbsp;
                                        
                                        <a class='label label-info' href='#'>Node</a>
                                        
                                        、
                                        
                                        <a class='label label-info' href='#'>Express</a>
                                        
                                        、
                                        
                                        <a class='label label-info' href='#'>API</a>
                                        
                                        
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class='article-main'>
                        <div class='panel panel-default'>
                            <div class='panel-body'>
                                <div class='article-content'>
                                    <h2>Express4.x API 翻译[4] -- Router</h2>

<h3>Router()</h3>

<p>路由器是一个孤立的中间件和路由实例。路由器被看作是唯一能胜任中间件和路由的迷你应用。每个express应用都包含一个内置的路由器。</p>

<p>路由器行为像中间件本身，可以在应用或者其他路由里使用。</p>

<p>使用"express.Router()"创建一个新的路由器。</p>

<pre><code>var router = express.Router([options]);
</code></pre>

<p>改变路由行为的可选项：</p>

<ul>
<li>caseSensitive 开启大小写敏感，默认不开启，"/Foo"和"/foo"同样处理。</li>
<li><p>Strict 开启严格路由，默认"/foo"和"/foo/"指向同一个路由。</p>

<pre><code>  // invoked for any requests passed to this router
  router.use(function(req, res, next) {
    // .. some logic here .. like any other middleware
    next();
  });

  // will handle any request that ends in /events
  // depends on where the router is "use()'d"
  router.get('/events', function(req, res, next) {
    // ..
  });
</code></pre></li>
</ul>


<p>然后你可以使用一个特定的根url路由器，像这样分离路由到多个文件或者迷你应用。</p>

<pre><code>// only requests to /calendar/* will be sent to our "router"
app.use('/calendar', router);
</code></pre>

<h3>router.use([path], function)</h3>

<p>使用中间件功能，可配置挂载路径，默认挂到"/"根路径。</p>

<p>中间件像一个管道，请求从第一个你定义的中间件开始，然后沿着这个线路一直向下，匹配每一个中间件堆栈中符合的路由。</p>

<pre><code>var express = require('express');
var app = express();
var router = express.Router();

// simple logger for this router's requests
// all requests to this router will first hit this middleware
router.use(function(req, res, next) {
  console.log('%s %s %s', req.method, req.url, req.path);
  next();
});

// this will only be invoked if the path ends in /bar
router.use('/bar', function(req, res, next) {
  // ... maybe some additional /bar logging ...
  next();
});

// always invoked
router.use(function(req, res, next) {
  res.send('Hello World');
});

app.use('/foo', router);

app.listen(3000);
</code></pre>

<p>挂载路径被剥离，是不可见的中间件功能。此功能的主要用途是挂载中间件的操作不需要根据它的前缀路径来修改代码。</p>

<p>使用router.user()定义中间件的顺序非常重要，他们依次被调用，因此这个决定中间件的优先级。例如通常logger是第一个需要用到的中间件，用来记录每个请求：</p>

<pre><code>var logger = require('morgan');

router.use(logger());
router.use(express.static(__dirname + '/public'));
router.use(function(req, res){
  res.send('Hello');
});
</code></pre>

<p>现在假设你想忽略静态文件请求的日志，但在logger()之间继续记录路径跟中间件日志，你只需要将static()移到前面：</p>

<pre><code>router.use(express.static(__dirname + '/public'));
router.use(logger());
router.use(function(req, res){
  res.send('Hello');
});
</code></pre>

<p>另一个具体的例子是来自多个文件目录的文件服务，优先从"./public"中查找：</p>

<pre><code>app.use(express.static(__dirname + '/public'));
app.use(express.static(__dirname + '/files'));
app.use(express.static(__dirname + '/uploads'));
</code></pre>

<h3>router.param([name], callback)</h3>

<p>路由参数映射逻辑。例如当一个路由中包含:user，加载逻辑会自动提供req.user给路由，或者执行参数输入验证。</p>

<p>下面的代码说明了如果回调，很像中间件，从而支持异步操作，但多了一个id参数。当执行加载用户时，验证req.user，不成功抛出一个错误到next(err)。</p>

<p>要注意，触发一个命名参数函数来运行路由，仅仅在next在没有被参数处理错误调用的情况下执行。</p>

<pre><code>router.param('user', function(req, res, next, id){
  User.find(id, function(err, user){
    if (err) {
      return next(err);
    }
    else if (!user) {
      return next(new Error('failed to load user'));
    }

    req.user = user;
    next();
  });
});

// this route uses the ":user" named parameter
// which will cause the 'user' param callback to be triggered
router.get('/users/:user', function(req, res, next) {
  // req.user WILL be defined here
  // if there was an error, normal error handling will be triggered
  // and this function will NOT execute
});
</code></pre>

<p>另外你可能只传递一个回调函数，在这种情况下你有机会修改router.param()API。例如express_params定义的回调函数允许你限制参数为给定的正则表达式。</p>

<p>这个例子有点超前，检查当第二个参数为正则表达式时，返回类似"user"参数示例的回调函数。</p>

<pre><code>router.param(function(name, fn){
  if (fn instanceof RegExp) {
    return function(req, res, next, val){
      var captures;
      if (captures = fn.exec(String(val))) {
        req.params[name] = captures;
        next();
      } else {
        next('route');
      }
    }
  }
});
</code></pre>

<p>该方法现在被用来有效的验证参数，或者解析他们提供分组：</p>

<pre><code>router.param('id', /^\d+$/);

router.get('/user/:id', function(req, res){
  res.send('user ' + req.params.id);
});

router.param('range', /^(\w+)\.\.(\w+)?$/);

router.get('/range/:range', function(req, res){
  var range = req.params.range;
  res.send('from ' + range[1] + ' to ' + range[2]);
});
</code></pre>

<p>router.user()方法也支持命名参数，使其他路由提供的挂载点能使用命名参数预加载。</p>

<h3>router.route(path)xl</h3>

<p>返回一个可以用来处理HTTP请求带有可选中间件的中间件路由。推荐使用router.route()避免重复路由定义和拼写错误。</p>

<p>根据前面所学建立route.param()示例，我们看到router.route()可以让我们轻松的应对各种HTTP请求处理。</p>

<pre><code>var router = express.Router();

router.param('user_id', function(req, res, next, id) {
  // sample user, would actually fetch from DB, etc...
  req.user = {
    id: id,
    name: 'TJ'
  };
  next();
});

router.route('/users/:user_id')
.all(function(req, res, next) {
  // runs for all HTTP verbs first
  // think of it as route specific middleware!
})
.get(function(req, res, next) {
  res.json(req.user);
})
.put(function(req, res, next) {
  // just an example of maybe updating the user
  req.user.name = req.params.name;
  // save user ... etc
  res.json(req.user);
})
.post(function(req, res, next) {
  next(new Error('not implemented'));
})
.delete(function(req, res, next) {
  next(new Error('not implemented'));
})
</code></pre>

<p>这个方法重新使用单'/users/:user_id'路径，添加对各种HTTP请求的处理。</p>

<h3>router.VERB(path, [callback...], callback)</h3>

<p>Express中router.VERB()方法提供路由功能，其中WERB属于HTTP请求，例如router.post()。可以有多个回调，所有回调同等对待，行为很像中间件，遇到异常时这些回调会调用next(‘route’)不再执行剩余的回调。这种机制可以用来执行有先决条件的路由，然后将控制权移交到其他没有限制的路由。</p>

<p>下面的代码演示了最简单路由定义。Express将这些路径转换成正则表达式，内部用来匹配即将到来的请求。在执行路由匹配时查询字符串不用考虑，例如"GET /"匹配的路由与"GET /?name=tobi"是一致的。</p>

<pre><code>router.get('/', function(req, res){
  res.send('hello world');
});
</code></pre>

<p>正则表达式也可以使用，当你有非常特殊的限制的时候是很有用的，例如"GET /commits/71dbb9c"能很好的匹配路由"GET /commits/71dbb9c..4c084f9"。</p>

<pre><code>router.get(/^\/commits\/(\w+)(?:\.\.(\w+))?$/, function(req, res){
  var from = req.params[0];
  var to = req.params[1] || 'HEAD';
  res.send('commit range ' + from + '..' + to);
});
</code></pre>

                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class='col-md-3 hidden-sm hidden-xs sidebar'>

                <div class='authorbar panel panel-default'>
                    <div class='panel-heading'>
                        <h4 class='panel-title'>作品信息</h4>
                    </div>
                    <div class='author-info row panel-body'>
                        <a class='col-lg-3 col-md-4'>
                            <img width='58' height='58' src='/images/pix3.jpg' alt='作者头像'>
                        </a>
                        <div class='col-md-6 media-body'>
                            
                            <h4 class='author-name media-heading'>
                                <a id='author_url' href='/authors/jacky/'>Jacky</a>
                            
                            
                            
                            </h4>
                            <span id='article_num'></span>
                        </div>
                    </div>
                </div><!--end of authorbar-->
                
                <div class='newbar panel panel-default'>
                    <div class='panel-heading'>
                        <h4 class='panel-title'>最新博文</h4>
                    </div>
                    <div class='list-group new-list'>
                        
                        <div class='list-group-item list-group-item-default'>
                            <h5 class='new-heading'>
                                <a href='/blog/2014/08/27/jQuery-source-analysis-ajax(2).html' title='jQuery源码解读[14] -- AJAX（2）'>jQuery源码解读[14] -- AJAX（2）</a>
                            </h5>
                            <span class='desc'>异步JavaScript和XML(Asynchronous JavaScr...</span>
                            <div class='new-post-info'>
                                <span class='new-date'>
                                    <span class='glyphicon glyphicon-calendar'></span>
                                    <span class='sr-only'>&nbsp;:&nbsp;</span>
                                    2014-08-27
                                </span>&nbsp;&nbsp;
                                <span class='new-author'>
                                    <span class='glyphicon glyphicon-user'></span>
                                    <span class='sr-only'>&nbsp;:&nbsp;</span>
                                    
                                    <a href='/authors/wanzhou/'>万洲</a>
                                </span>
                            </div>
                        </div>
                        <div class='list-group-item list-group-item-default'>
                            <h5 class='new-heading'>
                                <a href='/blog/2014/08/26/jQuery-source-analysis-ajax(1).html' title='jQuery源码解读[13] -- AJAX（1）'>jQuery源码解读[13] -- AJAX（1）</a>
                            </h5>
                            <span class='desc'>异步JavaScript和XML(Asynchronous JavaScr...</span>
                            <div class='new-post-info'>
                                <span class='new-date'>
                                    <span class='glyphicon glyphicon-calendar'></span>
                                    <span class='sr-only'>&nbsp;:&nbsp;</span>
                                    2014-08-26
                                </span>&nbsp;&nbsp;
                                <span class='new-author'>
                                    <span class='glyphicon glyphicon-user'></span>
                                    <span class='sr-only'>&nbsp;:&nbsp;</span>
                                    
                                    <a href='/authors/wanzhou/'>万洲</a>
                                </span>
                            </div>
                        </div>
                        <div class='list-group-item list-group-item-default'>
                            <h5 class='new-heading'>
                                <a href='/blog/2014/08/25/jQuery-source-analysis-attribute.html' title='jQuery源码解读[12] -- 特性属性操作'>jQuery源码解读[12] -- 特性属性操作</a>
                            </h5>
                            <span class='desc'>属性操作主要包括Attr特性和Prop属性两部分，attr特性就是存在于元...</span>
                            <div class='new-post-info'>
                                <span class='new-date'>
                                    <span class='glyphicon glyphicon-calendar'></span>
                                    <span class='sr-only'>&nbsp;:&nbsp;</span>
                                    2014-08-25
                                </span>&nbsp;&nbsp;
                                <span class='new-author'>
                                    <span class='glyphicon glyphicon-user'></span>
                                    <span class='sr-only'>&nbsp;:&nbsp;</span>
                                    
                                    <a href='/authors/wanzhou/'>万洲</a>
                                </span>
                            </div>
                        </div>
                        <div class='list-group-item list-group-item-default'>
                            <h5 class='new-heading'>
                                <a href='/blog/2014/08/22/jQuery-source-analysis-selector-expr.html' title='jQuery源码解读[11] -- 选择符表达式'>jQuery源码解读[11] -- 选择符表达式</a>
                            </h5>
                            <span class='desc'>jQuery的工厂函数$()用于在页面中查找要操作的元素，接收一个按照类似...</span>
                            <div class='new-post-info'>
                                <span class='new-date'>
                                    <span class='glyphicon glyphicon-calendar'></span>
                                    <span class='sr-only'>&nbsp;:&nbsp;</span>
                                    2014-08-22
                                </span>&nbsp;&nbsp;
                                <span class='new-author'>
                                    <span class='glyphicon glyphicon-user'></span>
                                    <span class='sr-only'>&nbsp;:&nbsp;</span>
                                    
                                    <a href='/authors/wanzhou/'>万洲</a>
                                </span>
                            </div>
                        </div>
                        <div class='list-group-item list-group-item-default'>
                            <h5 class='new-heading'>
                                <a href='/blog/2014/08/22/jQuery-source-analysis-css.html' title='jQuery源码解读[10] -- CSS样式应用'>jQuery源码解读[10] -- CSS样式应用</a>
                            </h5>
                            <span class='desc'>在JavaScript的世界里，效果会令操作体验及交互体验更胜一筹，通过j...</span>
                            <div class='new-post-info'>
                                <span class='new-date'>
                                    <span class='glyphicon glyphicon-calendar'></span>
                                    <span class='sr-only'>&nbsp;:&nbsp;</span>
                                    2014-08-22
                                </span>&nbsp;&nbsp;
                                <span class='new-author'>
                                    <span class='glyphicon glyphicon-user'></span>
                                    <span class='sr-only'>&nbsp;:&nbsp;</span>
                                    
                                    <a href='/authors/wanzhou/'>万洲</a>
                                </span>
                            </div>
                        </div>
                    </div>
                </div><!--end of newestbar-->
            </div>
        </div>
    </div>

</body>
</html>	
